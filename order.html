<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Place Order | Central & Stores</title>

<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">

<style>
*{margin:0;padding:0;box-sizing:border-box;font-family:'Poppins',sans-serif;}
body{background:#f2f4f7;padding:16px;}

.card{
  background:#fff;
  border-radius:18px;
  padding:16px;
  box-shadow:0 6px 16px rgba(0,0,0,.08);
}

h3{margin-bottom:12px;}

input,textarea,select{
  width:100%;
  padding:12px;
  margin-bottom:10px;
  border-radius:12px;
  border:1px solid #ccc;
  font-size:14px;
}

button{
  width:100%;
  padding:14px;
  border:none;
  border-radius:14px;
  background:#0fbf4a;
  color:#fff;
  font-size:16px;
  font-weight:700;
}
.order-row{
  display:flex;
  justify-content:space-between;
  gap:12px;
  background:#fff;
  padding:12px;
  border-radius:14px;
  margin-top:10px;
  box-shadow:0 6px 16px rgba(0,0,0,.1);
}

.order-left b{
  font-size:15px;
}

.qty{
  font-size:13px;
  opacity:.7;
}

.order-right{
  text-align:right;
}

.order-right select{
  padding:6px 8px;
  border-radius:8px;
  border:1px solid #ddd;
}

.price{
  margin-top:6px;
  font-weight:700;
  color:#16a34a;
}

  
</style>
</head>

<body>
<div class="card">
  <h3>ðŸ›’ Order Items</h3>
  <div id="orderItems"></div>
</div>
  
<div class="card">
  <h3>Customer Details</h3>

  <input id="custName" placeholder="Name">
  <textarea id="custAddress" placeholder="Address" rows="3"></textarea>
  <input id="custMobile" placeholder="Mobile Number">

  <select id="orderRange">
    <option value="">Estimated Order Value</option>
    <option>â‚¹200 â€“ â‚¹500</option>
    <option>â‚¹500 â€“ â‚¹1000</option>
    <option>â‚¹1000+</option>
  </select>

  <button onclick="placeOrder()">Place Order</button>
</div>
<script src="price.js"></script>

<script>
const cart = JSON.parse(localStorage.getItem("cart")) || [];

function renderOrderItems(){
  let html = "";

  cart.forEach((item, index) => {
  message += `${index + 1}. ${item.name}
Brand: ${item.brand || "Not selected"}
Qty: ${item.qty}
Price: â‚¹${item.price || 0}

`;
});

    html += `
      <div class="order-row">
        <div class="order-left">
          <b>${item.name}</b>
          <div class="qty">Qty: ${item.qty}</div>
        </div>

        <div class="order-right">
          <select onchange="updatePrice(${index}, this.value)">
            <option value="">Select Brand</option>
            ${brandList.map(b=>`<option value="${b}">${b}</option>`).join("")}
          </select>

          <div class="price" id="price-${index}">â‚¹ --</div>
        </div>
      </div>
    `;
  });

  document.getElementById("orderItems").innerHTML = html;
}

function updatePrice(index, brand){
  const item = cart[index];
  item.brand = brand;
  item.price = getPrice(item.name, brand);

  document.getElementById(`price-${index}`).innerText =
    "â‚¹ " + item.price + " / Kg";

  localStorage.setItem("cart", JSON.stringify(cart));
}

renderOrderItems();
</script>

  

<script>
async function placeOrder(){
  const name = document.getElementById("custName").value.trim();
  const address = document.getElementById("custAddress").value.trim();
  const mobile = document.getElementById("custMobile").value.trim();
  const range = document.getElementById("orderRange").value;

  if(!name || !address || !mobile || !range){
    alert("Please fill all details");
    return;
  }

  const cart = JSON.parse(localStorage.getItem("cart")) || [];
  if(cart.length === 0){
    alert("Cart is empty");
    return;
  }

  let message = `ðŸ›’ *New Grocery Order*\n\n`;
  message += `ðŸ‘¤ Name: ${name}\n`;
  message += `ðŸ“ž Mobile: ${mobile}\n`;
  message += `ðŸ“ Address: ${address}\n\n`;
  message += `ðŸ§º *Products:*\n`;

  cart.forEach((item, index) => {
    message += `${index + 1}. ${item.name} Ã— ${item.qty}\n`;
  });

  message += `\nðŸ’° *Estimated Order Value:* ${range}`;

  /* ðŸ”´ TELEGRAM DETAILS (CHANGE THESE) */
  const BOT_TOKEN = "YOUR_BOT_TOKEN_HERE";
  const CHAT_ID = "YOUR_CHAT_ID_HERE";

  const telegramURL = `https://api.telegram.org/bot${BOT_TOKEN}/sendMessage`;

  try{
    const response = await fetch(telegramURL, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({
        chat_id: CHAT_ID,
        text: message,
        parse_mode: "Markdown"
      })
    });

    const result = await response.json();

    if(result.ok){
      // âœ… Telegram received message
      localStorage.removeItem("cart");
      window.location.href = "success.html";
    }else{
      alert("Order not sent. Please try again.");
    }

  }catch(err){
    alert("Network error. Please check internet and try again.");
  }
}
</script>

</body>
</html>
